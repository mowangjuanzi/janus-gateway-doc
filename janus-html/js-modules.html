<p>To facilitate integration of <code>janus.js</code> within modular JavaScript code bases, you can instruct the build system(s) to generate a modular variants of <code>janus.js</code>. Generated modules may then be copied to your own JavaScript projects and seamlessly integrated with your own project's build system.</p>
<p>Building the modules can be done in two ways:</p>
<ol type="1">
<li>As part of a regular build of the Janus WebRTC Server, using <code>make</code>, by enabling the integrated support via <code>configure</code> </li>
<li>By running NPM commands manually. This may be useful if you are looking to build just the JavaScript modules without incurring the overhead of a full build of Janus.</li>
</ol>
<p>As an alternative to generating the module and copying it to your project, you can also tweak your module bundler to use <code>janus.js</code> directly from the official Janus repository. See more details (including concrete instructions for Webpack): <a class="el" href="#js-webpack">Using janus.js directly with Webpack and other bundlers</a></p>
<h1 class="doxsection"><a class="anchor" id="auto-build-js-modules"></a>
Building modules using make</h1>
<p>Each supported variant may be enabled by passing a corresponding <code>--enable-javascript-*-module</code> flag (with or without a <code>=yes</code> directive) to <code>configure</code> before invoking <code>make</code> to build Janus. Please note: if you do not pass any such flag, by default no modules will be built.</p>
<p>The following table provides a summary of available module formats and their corresponding <code>configure</code> options:</p>
<table class="table table-striped">
<tbody><tr>
<th>Module format (syntax)</th><th>File name</th><th>configure flag to pass</th></tr>
<tr>
<td>ECMAScript</td><td>janus.es.js</td><td><code>--enable-javascript-es-module</code> </td></tr>
<tr>
<td>Universal Module Definition (UMD)</td><td>janus.umd.js</td><td><code>--enable-javascript-umd-module</code> </td></tr>
<tr>
<td>CommonJS</td><td>janus.cjs.js</td><td><code>--enable-javascript-common-js-module</code> </td></tr>
<tr>
<td>Immediately Invoked Function Expression (IIFE)</td><td>janus.iife.js</td><td><code>--enable-javascript-iffe-module</code> </td></tr>
</tbody></table>
<p>The <code>--enable-all-js-modules</code> shortcut is available, in case you want to enable and build them all.</p>
<p>When built and installed, these module variants may be found in the <code>$PREFIX/share/janus/javascript</code> folder, alongside the <code>janus.js</code> file itself (assuming <code>$PREFIX</code> the installation directory passed to <code>configure</code>).</p>
<dl class="section note"><dt>Note</dt><dd>Building the JavaScript modules still requires NPM and may involve an <code>install</code> which means <code>npm</code> must be able to download dependencies. By default <code>configure</code> will attempt to auto-detect available <code>npm</code> on your PATH, but if you have installed NPM outside the PATH you can override this by passing the (full) path to your <code>npm</code> executable, e.g.:</dd></dl>
<pre class="fragment">./configure NPM=/path/to/my/custom/npm --enable-javascript-es-module=yes
</pre><h1 class="doxsection"><a class="anchor" id="manual-build-modules"></a>
Building modules manually with NPM</h1>
<p>You can also opt to build modules by invoking <code>npm</code> manually. The project root folder contains the necessary configuration files to get you started:</p>
<pre class="fragment">npm install
npm run rollup -- --o /path/to/desired/output/file-name.js --f cjs # or es, iffe, umd, amd, ...
</pre><p>Using <code>npm</code> directly is useful if you want to build the JavaScript modules only, without building Janus itself or if you are looking for advanced customisation options or alternative formats which are not integrated in <code>configure</code> yet. As you may have surmised from the example command, the actual build consists mostly of invoking <code>rollup</code> with the correct parameters. For more information on available parameters, please refer to the <code>rollup</code> documentation:</p>
<ol type="1">
<li><a href="https://rollupjs.org/#command-line-flags">https://rollupjs.org/#command-line-flags</a></li>
<li><a href="https://rollupjs.org/#configuration-files">https://rollupjs.org/#configuration-files</a></li>
</ol>
<h1 class="doxsection"><a class="anchor" id="js-webpack"></a>
Using janus.js directly with Webpack and other bundlers</h1>
<p>Generating a converted version of <code>janus.js</code> and copying it to your project is not always the best solution. In many situations it may be preferred to let your JavaScript module bundler (e.g. <a href="https://webpack.js.org">Webpack</a>) grab the file directly from the official Janus repository. Doing that you can manage <code>janus.js</code> just like any other dependency coming from Github or the npm Registry, getting rid of the manual copy step and letting the bundler take care of version management, updates and downloads.</p>
<p>Of course, the first step is to include the official Janus repository as a dependency in your project by adding it to your <code>packages.json</code> file.</p>
<pre class="fragment">{
  "dependencies": {
    "janus-gateway": "git://github.com/meetecho/janus-gateway.git"
  }
}
</pre><p>That will automatically drag in the dependency on the appropriate version of the <a href="https://www.npmjs.com/package/webrtc-adapter">WebRTC Adapter</a> from the npm Registry. But <code>janus.js</code> expects such adapter to be available as a global variable. So we have to make that happen for it to work properly. In the case of Webpack, is as easy as adding this to your <code>webpack.config.js</code> file. </p><pre class="fragment">const webpack = require('webpack');

module.exports = {
  plugins: [
    // janus.js does not use 'import' to access to the functionality of webrtc-adapter,
    // instead it expects a global object called 'adapter' for that.
    // Let's make that object available.
    new webpack.ProvidePlugin({ adapter: ['webrtc-adapter', 'default'] })
  ]
};
</pre><p>On the other hand, <code>janus.js</code> defines the <code>Janus</code> object globally. So a small tweak is also needed to serve such object via <code>export</code>. That can be done using <a href="https://webpack.js.org/loaders/exports-loader/">exports-loader</a> and adding this to <code>webpack.config.js</code> </p><pre class="fragment">module.exports = {
  module: {
    rules: [
      // janus.js does not use 'export' to provide its functionality to others, instead
      // it creates a global variable called 'Janus' and expects consumers to use it.
      // Let's use 'exports-loader' to simulate it uses 'export'.
      {
        test: require.resolve('janus-gateway'),
        loader: 'exports-loader',
         options: {
           exports: 'Janus',
         },
      }
    ]
  }
};
</pre><p>With that extra configuration, the official <code>janus.js</code> can be used directly in any modular JavaScript code base without any previous transformation of the file. That means you can simply do this to access to the Janus API from your modular code. </p><pre class="fragment">import { Janus } from 'janus-gateway';
</pre><p>For more detailed or updated documentation check the <a href="https://webpack.js.org/guides/shimming/">Webpack shimming guide</a> or the equivalent documentation for your bundler of choice. </p>
